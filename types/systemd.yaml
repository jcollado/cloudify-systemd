dsl_definitions:
  - &fabric_script
    service_name:
      type: string
      default: { get_property: [SELF, service_name] }
    use_sudo:
      type: boolean
      default: true
    fabric_env:
      default:
        user: { get_input: ssh_user }
        key_filename: { get_input: ssh_private_key_path }

node_types:
  systemd:
    derived_from: cloudify.nodes.SoftwareComponent
    properties:
      service_name:
        type: string
        description: systemd service name
      service_binary_path:
        type: string
        description: Path to service binary (if service file needs to be created)
        default: null
    interfaces:
      cloudify.interfaces.lifecycle:
        start:
          implementation: fabric.fabric_plugin.tasks.run_script
          inputs:
            <<: *fabric_script
            script_path:
              type: string
              default: scripts/systemd/systemd-start.sh
        stop:
          implementation: fabric.fabric_plugin.tasks.run_script
          inputs:
            <<: *fabric_script
            script_path:
              type: string
              default: scripts/systemd/systemd-stop.sh
